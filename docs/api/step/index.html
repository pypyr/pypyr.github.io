<!doctype html><html lang=en dir=ltr prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb#"><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>custom step | pypyr</title><meta name=description content="Create a custom pypyr pipeline task-runner step in a few lines of Python code. Ready-made retries & loops for your code."><link rel=stylesheet href=https://pypyr.io/css/styles.min.6191fc8e8750f8c6d5816e2fe9d4604d61f2f385a2a928b6d90370859d5a4a0f.css integrity="sha256-YZH8jodQ+MbVgW4v6dRgTWHy84WiqSi22QNwhZ1aSg8="><link rel=stylesheet href=https://pypyr.io/css/code-highlight.min.9cff1d5761d2c389dc957eb78bb442b045d34ab596ace3d02f822a06e8c3d2a2.css integrity="sha256-nP8dV2HSw4nclX63i7RCsEXTSrWWrOPQL4IqBujD0qI="><script defer src=https://pypyr.io/js/script.min.1e79eafb63b98bab206760a99aea6be09fdf4de525a6475528969c1e4834ed4b.js integrity="sha256-Hnnq+2O5i6sgZ2Cpmupr4J/fTeUlpkdVKJacHkg07Us="></script><link href="https://fonts.googleapis.com/css?family=Open+Sans:400,600,700%7cRoboto+Mono:400,400i&display=swap" rel=stylesheet><link rel=canonical href=https://pypyr.io/docs/api/step/><script async src="https://www.googletagmanager.com/gtag/js?id=UA-147150909-1"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','UA-147150909-1');</script><meta property="og:description" content="Create a custom pypyr pipeline task-runner step in a few lines of Python code. Ready-made retries & loops for your code."><meta property="og:image" content="https://pypyr.io/images/1.91x1/pypyr-taskrunner-yaml-pipeline-automation-1200x628.5aa6465b3b9d2ca8d0d5a9f794ba7f379c522a8ba503129f2a35d2479ea2452d.png"><meta property="og:image:alt" content="pypyr is an open-source task-runner for automation pipelines defined in simple human-readable yaml."><meta property="og:image:height" content="628"><meta property="og:image:type" content="image/png"><meta property="og:image:width" content="1200"><meta property="og:site_name" content="pypyr technical documentation"><meta property="og:title" content="Easily code custom pipeline steps."><meta property="og:type" content="website"><meta property="og:url" content="https://pypyr.io/docs/api/step/"><meta name=twitter:card content="summary_large_image"><meta name=twitter:site content="@pypyrpipes"><script type=application/ld+json>{"@context":"https://schema.org","@graph":[{"@id":"https://pypyr.io/#organization","@type":"Organization","name":"pypyr","url":"https://pypyr.io/","description":"The pypyr project is a free open-source task-runner cli \u0026 python api for automation pipelines.","logo":{"@type":"ImageObject","url":"https://pypyr.io/images/pypyr-taskrunner-logo-square.63875e43ff40d8ae40e93a6043b4328b962f54f52974aaa27cedec52220de665.svg","height":112,"width":112},"sameAs":["https://github.com/pypyr/","https://twitter.com/pypyrpipes/","https://pypi.org/user/pypyr/","https://hub.docker.com/u/pypyr/","https://en.gravatar.com/pypyr/"]},{"@type":"TechArticle","author":{"@type":"Person","name":"pypyr contributor"},"articleSection":"api","dateModified":"2019-08-25T23:11:21+01:00","datePublished":"2019-08-21T00:00:00Z","headline":"Easily code custom pipeline steps.","image":[{"@type":"ImageObject","url":"https://pypyr.io/images/1x1/pypyr-taskrunner-yaml-pipeline-automation-1200x1200.52764d3c6f40232b3cdc33f5b8fbaeadad56cc310c8dd5588d30828296b5290d.png","height":1200,"width":1200},{"@type":"ImageObject","url":"https://pypyr.io/images/4x3/pypyr-taskrunner-yaml-pipeline-automation-1200x900.e8e70443377aeb11c190835e8d2ed0c844d31a82a0c2e8a744a9999cd03e0de9.png","height":900,"width":1200},{"@type":"ImageObject","url":"https://pypyr.io/images/16x9/pypyr-taskrunner-yaml-pipeline-automation-1920x1080.cc9ae11626c8312e087058adb13bfff702162ce39c355065170c1b87850f3034.png","height":1080,"width":1920}],"inLanguage":"en","mainEntityOfPage":{"@type":"WebPage","@id":"https://pypyr.io/docs/api/step/"},"publisher":{"@id":"https://pypyr.io/#organization"},"url":"https://pypyr.io/docs/api/step/","wordCount":556}]}</script><link rel=apple-touch-icon sizes=180x180 href=/favicons/apple-touch-icon.925deabb48d91a80924b5d04ff56d2b8f42ba1d1e1438cb7d8948cce1138208c.png><link rel=icon type=image/png sizes=32x32 href=/favicons/favicon-32x32.1641c9e43ac671cad6f741e4cee4ba0cc153d0bb4a577d620d7f7306f8e47227.png><link rel=icon type=image/png sizes=16x16 href=/favicons/favicon-16x16.db5c9fdd3646c9f360e8ab0c94bda84ca261f0de7a17e684f94a984607440e2c.png><link rel=manifest href=/favicons/site.3dad2bd5063ad6bc11f741ea28adf4df8b9370196f6e64af6789cf181cef05c6.webmanifest><link rel=mask-icon href=/favicons/safari-pinned-tab.5d5f5d4e05cdd733ea9957bdf664db67a75fd9b1d2ab56e9c5561136f3ffb5d8.svg color=#4f9a94><link rel="shortcut icon" href=/favicons/favicon.dca49ca2cfdb497af8cfd9c557b26b5e29d6b28774623c8375e633d4a6ee9166.ico><meta name=msapplication-TileColor content="#00aba9"><meta name=msapplication-config content="/favicons/browserconfig.bbdaec7f39b7bd1f2d6bc484afdd0c7246e3af9c5b45d91198d8a3b42e024e1f.xml"><meta name=theme-color content="#121212"></head><body class=docs-grid><header class="header elevation-01"><a href=/ class=top-nav-logo aria-label=home><img class=top-nav-logo-img src=https://pypyr.io/images/pypyr-logotype.2c9aa98c472f0ea8d436597c26ef1b0f042624ee19cdf69bcb89ac0025d146c4.svg alt="pypyr logo"></a><nav class=top-nav-links aria-label="top navigation"><ul><li><a href=/docs/ class=top-active>docs</a></li><li><a href=/updates/>updates</a></li><li><a href=/topics/>topics</a></li><li><a href=https://twitter.com/pypyrpipes/><span class=top-nav-links-pre><svg viewBox="0 0 250 203.18"><title>twitter link</title><use xlink:href="https://pypyr.io/images/twitter-logo.32b6991dff0a6cdd82b85ab0ac665f0bcd9169e7de5f5fafab2faf82af03bbef.svg#twitter-logo"/></svg></span></a></li><li><a href=https://github.com/pypyr/pypyr-cli/><span class=top-nav-links-pre><svg viewBox="0 0 477 97.41"><title>github repo</title><use xlink:href="https://pypyr.io/images/github-mark-and-logo.886cf0c92233b5996c7d33c45283ce17e926bc4c2dd432712cfd2b903dca4b22.svg#github-mark-and-logo"/></svg></span></a></li></ul></nav></header><button id=show-leftnav class="neutral-button icon-button primary-button"><svg class="show-leftnav-chevron"><title>open main navigation menu</title><use href="https://pypyr.io/icons/chevron-right.e586e5df0f820697b2ce08d042d0110568a2faeb11c7f0bab5a33df79dd3d6db.svg#chevron-right"/></svg></button><nav id=leftnavmenu class="leftnavmenu elevation-03" aria-label="Primary Navigation"><button id=hide-leftnav class="neutral-button icon-button"><svg class="hide-leftnav-chevron"><title>close navigation menu</title><use href="https://pypyr.io/icons/chevron-right.e586e5df0f820697b2ce08d042d0110568a2faeb11c7f0bab5a33df79dd3d6db.svg#chevron-right"/></svg></button><ul class=leftnavroot><li><button class="nav-section-chevron-title neutral-button">
<span class=nav-section-pointer><svg class="nav-chevron"><title>open or close sub-menu</title><use href="https://pypyr.io/icons/chevron-right.e586e5df0f820697b2ce08d042d0110568a2faeb11c7f0bab5a33df79dd3d6db.svg#chevron-right"/></svg><span>getting started</span></span></button><ul class=nested><li><a href=/docs/getting-started/>overview</a></li><li><a href=/docs/getting-started/installation/>install pypyr</a></li><li><a href=/docs/getting-started/run-your-first-pipeline/>run your first pipeline</a></li><li><a href=/docs/getting-started/basic-concepts/>basic concepts</a></li><li><a href=/docs/getting-started/error-handling/>error handling</a></li></ul></li><li><button class="nav-section-chevron-title neutral-button">
<span class=nav-section-pointer><svg class="nav-chevron"><title>open or close sub-menu</title><use href="https://pypyr.io/icons/chevron-right.e586e5df0f820697b2ce08d042d0110568a2faeb11c7f0bab5a33df79dd3d6db.svg#chevron-right"/></svg><span>cli</span></span></button><ul class=nested><li><a href=/docs/cli/>overview</a></li><li><a href=/docs/cli/run-a-pipeline/>run a pipeline</a></li><li><a href=/docs/cli/custom-args/>custom args</a></li></ul></li><li><button class="nav-section-chevron-title neutral-button">
<span class=nav-section-pointer><svg class="nav-chevron"><title>open or close sub-menu</title><use href="https://pypyr.io/icons/chevron-right.e586e5df0f820697b2ce08d042d0110568a2faeb11c7f0bab5a33df79dd3d6db.svg#chevron-right"/></svg><span>pipelines</span></span></button><ul class=nested><li><a href=/docs/pipelines/>overview</a></li><li><a href=/docs/pipelines/pipeline-structure/>pipeline structure</a></li><li><a href=/docs/pipelines/builtin-pipelines/>built-in pipelines</a></li><li><a href=/docs/pipelines/lookup-order/>lookup order</a></li></ul></li><li><button class="nav-section-chevron-title neutral-button">
<span class=nav-section-pointer><svg class="nav-chevron"><title>open or close sub-menu</title><use href="https://pypyr.io/icons/chevron-right.e586e5df0f820697b2ce08d042d0110568a2faeb11c7f0bab5a33df79dd3d6db.svg#chevron-right"/></svg><span>context parsers</span></span></button><ul class=nested><li><a href=/docs/context-parsers/>overview</a></li><li><a href=/docs/context-parsers/dict/>dict</a></li><li><a href=/docs/context-parsers/json/>json</a></li><li><a href=/docs/context-parsers/jsonfile/>jsonfile</a></li><li><a href=/docs/context-parsers/keys/>keys</a></li><li><a href=/docs/context-parsers/keyvaluepairs/>keyvaluepairs</a></li><li><a href=/docs/context-parsers/list/>list</a></li><li><a href=/docs/context-parsers/string/>string</a></li><li><a href=/docs/context-parsers/yamlfile/>yamlfile</a></li></ul></li><li><button class="nav-section-chevron-title neutral-button">
<span class=nav-section-pointer><svg class="nav-chevron"><title>open or close sub-menu</title><use href="https://pypyr.io/icons/chevron-right.e586e5df0f820697b2ce08d042d0110568a2faeb11c7f0bab5a33df79dd3d6db.svg#chevron-right"/></svg><span>decorators</span></span></button><ul class=nested><li><a href=/docs/decorators/>overview</a></li><li><a href=/docs/decorators/comment/>comment</a></li><li><a href=/docs/decorators/description/>description</a></li><li><a href=/docs/decorators/foreach/>foreach</a></li><li><a href=/docs/decorators/in/>in</a></li><li><a href=/docs/decorators/onerror/>onError</a></li><li><a href=/docs/decorators/retry/>retry</a></li><li><a href=/docs/decorators/run/>run</a></li><li><a href=/docs/decorators/skip/>skip</a></li><li><a href=/docs/decorators/swallow/>swallow</a></li><li><a href=/docs/decorators/while/>while</a></li></ul></li><li><button class="nav-section-chevron-title neutral-button">
<span class=nav-section-pointer><svg class="nav-chevron"><title>open or close sub-menu</title><use href="https://pypyr.io/icons/chevron-right.e586e5df0f820697b2ce08d042d0110568a2faeb11c7f0bab5a33df79dd3d6db.svg#chevron-right"/></svg><span>steps</span></span></button><ul class=nested><li><a href=/docs/steps/>overview</a></li><li><a href=/docs/steps/assert/>assert</a></li><li><a href=/docs/steps/call/>call</a></li><li><a href=/docs/steps/cmd/>cmd</a></li><li><a href=/docs/steps/contextclear/>contextclear</a></li><li><a href=/docs/steps/contextclearall/>contextclearall</a></li><li><a href=/docs/steps/contextmerge/>contextmerge</a></li><li><a href=/docs/steps/contextset/>contextset</a></li><li><a href=/docs/steps/contextsetf/>contextsetf</a></li><li><a href=/docs/steps/debug/>debug</a></li><li><a href=/docs/steps/default/>default</a></li><li><a href=/docs/steps/echo/>echo</a></li><li><a href=/docs/steps/env/>env</a></li><li><a href=/docs/steps/envget/>envget</a></li><li><a href=/docs/steps/fetchjson/>fetchjson</a></li><li><a href=/docs/steps/fetchyaml/>fetchyaml</a></li><li><a href=/docs/steps/fileformat/>fileformat</a></li><li><a href=/docs/steps/fileformatjson/>fileformatjson</a></li><li><a href=/docs/steps/fileformatyaml/>fileformatyaml</a></li><li><a href=/docs/steps/filereplace/>filereplace</a></li><li><a href=/docs/steps/filewritejson/>filewritejson</a></li><li><a href=/docs/steps/filewriteyaml/>filewriteyaml</a></li><li><a href=/docs/steps/glob/>glob</a></li><li><a href=/docs/steps/jump/>jump</a></li><li><a href=/docs/steps/now/>now</a></li><li><a href=/docs/steps/nowutc/>nowutc</a></li><li><a href=/docs/steps/pathcheck/>pathcheck</a></li><li><a href=/docs/steps/py/>py</a></li><li><a href=/docs/steps/pype/>pype</a></li><li><a href=/docs/steps/pypyrversion/>pypyrversion</a></li><li><a href=/docs/steps/safeshell/>safeshell</a></li><li><a href=/docs/steps/shell/>shell</a></li><li><a href=/docs/steps/stop/>stop</a></li><li><a href=/docs/steps/stoppipeline/>stoppipeline</a></li><li><a href=/docs/steps/stopstepgroup/>stopstepgroup</a></li><li><a href=/docs/steps/tar/>tar</a></li></ul></li><li><button class="nav-section-chevron-title neutral-button">
<span class=nav-section-pointer><svg class="nav-chevron"><title>open or close sub-menu</title><use href="https://pypyr.io/icons/chevron-right.e586e5df0f820697b2ce08d042d0110568a2faeb11c7f0bab5a33df79dd3d6db.svg#chevron-right"/></svg><span>substitutions</span></span></button><ul class=nested><li><a href=/docs/substitutions/>overview</a></li><li><a href=/docs/substitutions/format-string/>format string</a></li><li><a href=/docs/substitutions/py-strings/>py string</a></li><li><a href=/docs/substitutions/sic-strings/>sic string</a></li></ul></li><li><button class="nav-section-chevron-title neutral-button">
<span class=nav-section-pointer><svg class="nav-chevron"><title>open or close sub-menu</title><use href="https://pypyr.io/icons/chevron-right.e586e5df0f820697b2ce08d042d0110568a2faeb11c7f0bab5a33df79dd3d6db.svg#chevron-right"/></svg><span>plugins</span></span></button><ul class=nested><li><a href=/docs/plugins/>overview</a></li></ul></li><li><button class="nav-section-chevron-title neutral-button">
<span class=nav-section-pointer><svg class="nav-chevron nav-chevron-down"><title>open or close sub-menu</title><use href="https://pypyr.io/icons/chevron-right.e586e5df0f820697b2ce08d042d0110568a2faeb11c7f0bab5a33df79dd3d6db.svg#chevron-right"/></svg><span>api</span></span></button><ul class="nested expand"><li><a href=/docs/api/>overview</a></li><li><a href=/docs/api/context-parser/>context parser</a></li><li><a href=/docs/api/pipeline-loader/>pipeline loader</a></li><li><a href=/docs/api/run-pipeline/>run pipeline</a></li><li class=currentpage><a href=/docs/api/step/>step</a></li></ul></li><li><button class="nav-section-chevron-title neutral-button">
<span class=nav-section-pointer><svg class="nav-chevron"><title>open or close sub-menu</title><use href="https://pypyr.io/icons/chevron-right.e586e5df0f820697b2ce08d042d0110568a2faeb11c7f0bab5a33df79dd3d6db.svg#chevron-right"/></svg><span>contributing</span></span></button><ul class=nested><li><a href=/docs/contributing/>overview</a></li><li><a href=/docs/contributing/contribute-to-pypyr/>contribute to pypyr</a></li><li><a href=/docs/contributing/developers-guide/>developer's guide for pypyr</a></li></ul></li><li><button class="nav-section-chevron-title neutral-button">
<span class=nav-section-pointer><svg class="nav-chevron"><title>open or close sub-menu</title><use href="https://pypyr.io/icons/chevron-right.e586e5df0f820697b2ce08d042d0110568a2faeb11c7f0bab5a33df79dd3d6db.svg#chevron-right"/></svg><span>thank you</span></span></button><ul class=nested><li><a href=/docs/thank-you/>overview</a></li><li><a href=/docs/thank-you/dependencies/>dependencies</a></li></ul></li></ul></nav><div class="docs-content content-grid"><ol class=breadcrumb vocab="http://schema.org/" typeof="BreadcrumbList"><li property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" href=https://pypyr.io/><span property="name">pypyr</span></a><meta property="position" content="1"></li><li property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" href=https://pypyr.io/docs/><span property="name">docs</span></a><meta property="position" content="2"></li><li property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" href=https://pypyr.io/docs/api/><span property="name">api</span></a><meta property="position" content="3"></li><li property="itemListElement" typeof="ListItem"><span property="name">step</span><meta property="position" content="4"></li></ol><aside class="grid-toc elevation-02"><h6 id=table-of-contents>on this page</h6><nav id=TableOfContents><ol><li><a href=#step-function-signature>step function signature</a></li><li><a href=#use-custom-step-in-a-pipeline>use custom step in a pipeline</a><ol><li><a href=#module-path-resolution>module path resolution</a></li><li><a href=#passing-context--decorators>passing context & decorators</a></li></ol></li></ol></nav></aside><main class=grid-main><article><h1 id=create-a-custom-step>create a custom step <a href=#create-a-custom-step class=headline-anchor aria-label=anchor><svg class="permalink"><title>permalink</title><use href="https://pypyr.io/icons/external-link.054f8ebb57944b2bc52ea4f0ecd16197.svg#external-link"/></svg></a></h1><p>If you can&rsquo;t find a ready-made step that quite scratches your particular itch,
don&rsquo;t hesitate to code your own step - it&rsquo;s easy, and very much the philosophy
of pypyr that if you can write a quick couple of lines of python rather than
contort your pipeline with clumsy step sequences, then do so! I know some
frameworks don&rsquo;t really encourage you to stray outside the prescribed features,
but not so pypyr - your custom steps are first-class citizens of the pypyrverse.</p><p>You can freely mix your own custom steps and built-in steps in the same pipeline.</p><p>If you do code your own and you think it could be useful to the rest of the
community, even if it&rsquo;s trivial, check out the
<a href=https://pypyr.io/docs/contributing/contribute-to-pypyr/>contribution guide</a> for
how to submit your code and then you can bask in the glow of making open-source
a better place.</p><p>If you don&rsquo;t code or that sounds like too much work, but you have an idea for a
new step that would make your life better, feel very free to
<a href="https://github.com/pypyr/pypyr-cli/issues/new?title=step%20suggestion:&labels=feature,type:%20step">get in touch</a>
with a feature request.</p><h2 id=step-function-signature>step function signature <a href=#step-function-signature class=headline-anchor aria-label=anchor><svg class="permalink"><title>permalink</title><use href="https://pypyr.io/icons/external-link.054f8ebb57944b2bc52ea4f0ecd16197.svg#external-link"/></svg></a></h2><div class=highlight><pre class=chroma><code class=language-python data-lang=python><span class=kn>import</span> <span class=nn>logging</span>


<span class=c1># getLogger will grab the parent logger context, so your loglevel and</span>
<span class=c1># formatting automatically will inherit correctly from the pypyr core.</span>
<span class=n>logger</span> <span class=o>=</span> <span class=n>logging</span><span class=o>.</span><span class=n>getLogger</span><span class=p>(</span><span class=vm>__name__</span><span class=p>)</span>


<span class=k>def</span> <span class=nf>run_step</span><span class=p>(</span><span class=n>context</span><span class=p>):</span>
    <span class=s2>&#34;&#34;&#34;Put your code in here. This shows you how to code a custom pipeline step.
</span><span class=s2>
</span><span class=s2>    Args:
</span><span class=s2>      context: dict-like. This is the entire pypyr context.
</span><span class=s2>               You can mutate context in this step to make
</span><span class=s2>               keys/values &amp; data available to subsequent
</span><span class=s2>               pipeline steps.
</span><span class=s2>
</span><span class=s2>    Returns:
</span><span class=s2>      None.
</span><span class=s2>    &#34;&#34;&#34;</span>
    <span class=n>logger</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=s2>&#34;started&#34;</span><span class=p>)</span>
    <span class=c1># you probably want to do some asserts here to check that the input context</span>
    <span class=c1># dictionary contains the keys and values you need for your code to work.</span>
    <span class=n>context</span><span class=o>.</span><span class=n>assert_key_has_value</span><span class=p>(</span><span class=n>key</span><span class=o>=</span><span class=s1>&#39;mykey&#39;</span><span class=p>,</span> <span class=n>caller</span><span class=o>=</span><span class=vm>__name__</span><span class=p>)</span>
    
    <span class=c1># do this if you want your step to support substitutions.</span>
    <span class=c1># get_formatted will also iterate mykey if it&#39;s an iterable</span>
    <span class=c1># and do substitutions for each item in it.</span>
    <span class=n>mystep_context</span> <span class=o>=</span> <span class=n>context</span><span class=o>.</span><span class=n>get_formatted</span><span class=p>(</span><span class=s1>&#39;mykey&#39;</span><span class=p>)</span>
    <span class=c1># assuming input context</span>
    <span class=c1># mykey:</span>
    <span class=c1>#  subkey: subkey value</span>
    <span class=n>nested_value</span> <span class=o>=</span> <span class=n>mystep_context</span><span class=p>[</span><span class=s1>&#39;subkey&#39;</span><span class=p>]</span>

    <span class=c1># get a context item if you don&#39;t care about substitutions</span>
    <span class=n>context_item</span> <span class=o>=</span> <span class=n>context</span><span class=p>[</span><span class=s1>&#39;arbkey&#39;</span><span class=p>]</span>

    <span class=c1># it&#39;s good form only to use .info and higher log levels when you must.</span>
    <span class=c1># For .debug() being verbose is very much encouraged.</span>
    <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&#34;Your clever code goes here. . . &#34;</span><span class=p>)</span>

    <span class=c1># Add or edit context items. These are available to any pipeline steps</span>
    <span class=c1># following this one.</span>
    <span class=n>context</span><span class=p>[</span><span class=s1>&#39;existingkey&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=s1>&#39;new value overwrites old value&#39;</span>
    <span class=n>context</span><span class=p>[</span><span class=s1>&#39;mynewcleverkey&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=s1>&#39;new value&#39;</span>

    <span class=n>logger</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=s2>&#34;done&#34;</span><span class=p>)</span>
</code></pre></div><h2 id=use-custom-step-in-a-pipeline>use custom step in a pipeline <a href=#use-custom-step-in-a-pipeline class=headline-anchor aria-label=anchor><svg class="permalink"><title>permalink</title><use href="https://pypyr.io/icons/external-link.054f8ebb57944b2bc52ea4f0ecd16197.svg#external-link"/></svg></a></h2><h3 id=module-path-resolution>module path resolution <a href=#module-path-resolution class=headline-anchor aria-label=anchor><svg class="permalink"><title>permalink</title><use href="https://pypyr.io/icons/external-link.054f8ebb57944b2bc52ea4f0ecd16197.svg#external-link"/></svg></a></h3><p>The usual python import module resolution rules apply. pypyr will resolve
modules from the
<a href=https://pypyr.io/docs/pipelines/lookup-order/#the-working-directory>working directory</a>
first, which you can change by using the <code>--dir</code> flag.</p><p>Assuming you saved your python with the <code>def run_step(context)</code> function in a
file like this <code>./dir/mystep.py</code>, you can use use it in your pipeline like
this:</p><div class=highlight><pre class=chroma><code class=language-yaml data-lang=yaml><span class=k>steps</span><span class=p>:</span><span class=w>
</span><span class=w>    </span>- step1<span class=w> </span><span class=c># runs ./step1.py</span><span class=w>
</span><span class=w>    </span>- dir.mystep<span class=w> </span><span class=c># runs ./dir/mystep.py</span><span class=w>
</span></code></pre></div><p>If you package your parser and you install the package into the active python
environment, you can of course use the usual python absolute package name
instead:</p><div class=highlight><pre class=chroma><code class=language-yaml data-lang=yaml><span class=k>steps</span><span class=p>:</span><span class=w>
</span><span class=w>    </span>- step1<span class=w>
</span><span class=w>    </span>- mypackage.mystep<span class=w>
</span></code></pre></div><h3 id=passing-context--decorators>passing context & decorators <a href=#passing-context--decorators class=headline-anchor aria-label=anchor><svg class="permalink"><title>permalink</title><use href="https://pypyr.io/icons/external-link.054f8ebb57944b2bc52ea4f0ecd16197.svg#external-link"/></svg></a></h3><p>All of the usual step decorators are available to your custom step. This makes
it easy to use retry, looping and conditional logic on your custom step code
without having to write any additional code.</p><div class=highlight><pre class=chroma><code class=language-yaml data-lang=yaml><span class=k>steps</span><span class=p>:</span><span class=w>
</span><span class=w>  </span>- step1<span class=w>
</span><span class=w>  </span>- <span class=k>name</span><span class=p>:</span><span class=w> </span>mystep<span class=w>
</span><span class=w>    </span><span class=k>comment</span><span class=p>:</span><span class=w> </span>run<span class=w> </span>./mystep.py<span class=w>
</span><span class=w>             </span>pass<span class=w> </span>input<span class=w> </span>context<span class=w> </span>values<span class=w> </span>to<span class=w> </span>the<span class=w> </span>step.<span class=w>
</span><span class=w>             </span>run<span class=w> </span>step<span class=w> </span><span class=m>3</span><span class=w> </span>times<span class=w> </span>in<span class=w> </span>total<span class=w> </span>for<span class=w> </span><span class=s2>&#34;first&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;second&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;third&#34;</span><span class=w>
</span><span class=w>             </span>retry<span class=w> </span>twice<span class=w> </span>if<span class=w> </span>the<span class=w> </span>step<span class=w> </span>fails.<span class=w>
</span><span class=w>    </span><span class=k>foreach</span><span class=p>:</span><span class=w> </span><span class=p>[</span>first<span class=p>,</span><span class=w> </span>second<span class=p>,</span><span class=w> </span>third<span class=p>]</span><span class=w>
</span><span class=w>    </span><span class=k>in</span><span class=p>:</span><span class=w>
</span><span class=w>      </span><span class=k>set</span><span class=p>:</span><span class=w> </span>your<span class=w> </span>own<span class=w>
</span><span class=w>      </span><span class=k>context</span><span class=p>:</span><span class=w> </span>input<span class=w> </span>here<span class=w>
</span><span class=w>      </span><span class=k>so</span><span class=p>:</span><span class=w> </span>your<span class=w> </span>step<span class=w> </span>can<span class=w> </span>use<span class=w> </span>it<span class=w>
</span><span class=w>    </span><span class=k>retry</span><span class=p>:</span><span class=w>
</span><span class=w>      </span><span class=k>max</span><span class=p>:</span><span class=w> </span><span class=m>2</span><span class=w>
</span><span class=w>  </span>- step3<span class=w>
</span><span class=w>
</span></code></pre></div></article><section class="see-also elevation-02"><h2>see also</h2><ul><li><a href=/docs/api/>api</a></li><li><a href=/docs/api/context-parser/>custom context parser</a></li><li><a href=/docs/api/pipeline-loader/>custom pype loader</a></li><li><a href=/docs/contributing/developers-guide/>developer's guide for pypyr</a></li><li><a href=/docs/api/run-pipeline/>run pipeline api</a></li></ul></section></main><aside class="grid-taxonomy elevation-02"><section class=page-taxonomy aria-label="related topics"><h6>topics</h6><ul id=topics class=small-list><li><a href=https://pypyr.io/topics/custom-code/ class=muted-with-hover>custom code</a></li></ul></section><section class=page-taxonomy aria-label="related categories"><h6>categories</h6><ul id=categories class=small-list><li><a href=https://pypyr.io/categories/steps/ class=muted-with-hover>steps</a></li></ul></section></aside><aside class="grid-improve elevation-02" aria-labelledby=feedback><h6 id=feedback>feedback</h6><ul class=small-list><li><a href=https://github.com/pypyr/docs/edit/master/content/docs/api/step.md class=muted-with-hover>edit me</a></li><li><a href="https://github.com/pypyr/docs/issues/new?title=docs%20issue:custom%20step&body=File:%20[custom%20step]%28https://pypyr.io/docs/api/step/%29" class=muted-with-hover>report typo</a></li><li><a href="https://github.com/pypyr/pypyr-cli/issues/new?title=Re:%20custom%20step&labels=bug" class=muted-with-hover>report bug!</a></li></ul></aside><div class="page-git-info elevation-02"><small class=small-block>last updated on <time datetime=2019-08-25T23:11:21+01:00>2019-08-25 23:11</time>.</small></div></div><footer class="footer elevation-01"><a href=/ class=top-nav-logo aria-label=home><img class=top-nav-logo-img src=https://pypyr.io/images/pypyr-logotype.2c9aa98c472f0ea8d436597c26ef1b0f042624ee19cdf69bcb89ac0025d146c4.svg alt="pypyr logo"></a><div class=col-1fr-centered><ul class=footer-social-links aria-label="social media links"><li><a href=https://twitter.com/pypyrpipes/ class=footer-social-link><div class=footer-social-links-pre><svg viewBox="0 0 400 400"><title>twitter link</title><use xlink:href="https://pypyr.io/icons/twitter-social-icon-circle-white.3ab578ddbdcbe34d5d0fe9c610d738ee9e02351e1a0e805388f3c3a73ef03768.svg#twitter-icon"/></svg></div><small>twitter</small></a></li><li><a href=https://github.com/pypyr/pypyr-cli/ class=footer-social-link><div class=footer-social-links-pre><svg viewBox="0 0 32.58 31.77"><title>github link</title><use xlink:href="https://pypyr.io/icons/github-icon.c340c354e626f38d39e8dc95748a14230bc3425c51aa3253ce97e70b4478a5fa.svg#github-icon"/></svg></div><small>github</small></a></li><li><a href=https://discordapp.com/invite/8353JkB class=footer-social-link><div class=footer-social-links-pre><svg viewBox="0 0 245 240"><title>discord chat link</title><use xlink:href="https://pypyr.io/icons/discord-social-icon-white.e6da190daed57741e47a5c2358bafbb08865e1cf1068fb2f2312a721da9dc5ca.svg#discord-icon"/></svg></div><small>discord</small></a></li></ul><ul class=footer-notices-links aria-label="legal notices"><li><a href=/legal/privacy-notice class=muted-with-hover><small>privacy</small></a></li><li><a href=/legal/licensing class=muted-with-hover><small>licensing</small></a></li><li><a href=/press-kit class=muted-with-hover><small>press</small></a></li></ul></div></footer><div class=bottom-spacer aria-hidden=true></div><div id=disabled-state-overlay aria-hidden=true class="disabled-state-overlay hide-overlay"></div></body></html>